\documentclass[a4paper,12pt]{article}

\input{header.tex}

\title{Отчёт по лабораторной работе \\ <<Механизмы протокола TCP>>}
\author{Фроловский Алексей Вадимович}

\begin{document}

\maketitle

\tableofcontents

% Текст отчёта должен быть читаемым!!! Написанное здесь является рыбой.

\section{Установка соединения}

Будем устанавливать соединение клиента на машине \textbf{c1} (10.10.0.2) с сервером
на машине \textbf{с4} (10.30.0.2). На участке между ними есть сеть 10.20.0.0/16 с
величиной MTU, равной 1492.

Вывод \textbf{tcpdump} на машине \textbf{c2} (интерфейс \textbf{eth0}):
\begin{Verbatim}
08:50:10.562062 IP 10.10.0.2.46215 > 10.30.0.2.9: S 1456747677:1456747677(0) win 5840 <mss 1460,sackOK,timestamp 4294952004 0,nop,wscale 1>
08:50:10.603672 IP 10.30.0.2.9 > 10.10.0.2.46215: S 1483117680:1483117680(0) ack 1456747678 win 5792 <mss 1452,sackOK,timestamp 4294952117 4294952004,nop,wscale 1>
08:50:10.604406 IP 10.10.0.2.46215 > 10.30.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 4294952011 4294952117>
08:50:12.731302 IP 10.10.0.2.46215 > 10.30.0.2.9: P 1:8(7) ack 1 win 2920 <nop,nop,timestamp 4294952225 4294952117>
08:50:12.732699 IP 10.30.0.2.9 > 10.10.0.2.46215: . ack 8 win 2896 <nop,nop,timestamp 4294952330 4294952225>
08:50:18.070170 IP 10.10.0.2.46215 > 10.30.0.2.9: F 8:8(0) ack 1 win 2920 <nop,nop,timestamp 4294952759 4294952330>
08:50:18.075915 IP 10.30.0.2.9 > 10.10.0.2.46215: F 1:1(0) ack 9 win 2896 <nop,nop,timestamp 4294952864 4294952759>
08:50:18.076319 IP 10.10.0.2.46215 > 10.30.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 4294952759 4294952864>
\end{Verbatim}

Вывод \textbf{tcpdump} на машине \textbf{c3} (интерфейс \textbf{eth0}):
\begin{Verbatim}
08:50:10.328976 IP 10.10.0.2.46215 > 10.30.0.2.9: S 1456747677:1456747677(0) win 5840 <mss 1460,sackOK,timestamp 4294952004 0,nop,wscale 1>
08:50:10.355222 IP 10.30.0.2.9 > 10.10.0.2.46215: S 1483117680:1483117680(0) ack 1456747678 win 5792 <mss 1452,sackOK,timestamp 4294952117 4294952004,nop,wscale 1>
08:50:10.356832 IP 10.10.0.2.46215 > 10.30.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 4294952011 4294952117>
08:50:12.483462 IP 10.10.0.2.46215 > 10.30.0.2.9: P 1:8(7) ack 1 win 2920 <nop,nop,timestamp 4294952225 4294952117>
08:50:12.484400 IP 10.30.0.2.9 > 10.10.0.2.46215: . ack 8 win 2896 <nop,nop,timestamp 4294952330 4294952225>
08:50:17.822580 IP 10.10.0.2.46215 > 10.30.0.2.9: F 8:8(0) ack 1 win 2920 <nop,nop,timestamp 4294952759 4294952330>
08:50:17.827245 IP 10.30.0.2.9 > 10.10.0.2.46215: F 1:1(0) ack 9 win 2896 <nop,nop,timestamp 4294952864 4294952759>
08:50:17.828594 IP 10.10.0.2.46215 > 10.30.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 4294952759 4294952864>
\end{Verbatim}

\section{Окно получателя}

Запустим программу \textbf{win} на машине \textbf{c4}:
\begin{Verbatim}
./win 3002 2 10
\end{Verbatim}
Здесь 3002 - номер порта, 2 - величина задержки в секундах, 10 - число принимаемых
пакетов.

Запустим клиент на машине \textbf{c1}:
\begin{Verbatim}
netcat 10.30.0.2 3002 </dev/zero
\end{Verbatim}

Вывод \textbf{tcpdump} на машине \textbf{с3} (интерфейс \textbf{eth0}):
\begin{Verbatim}
09:26:50.534058 IP 10.10.0.2.51410 > 10.30.0.2.3002: S 1595493701:1595493701(0) win 5840 <mss 1460,sackOK,timestamp 204705 0,nop,wscale 1>
09:26:50.557198 IP 10.30.0.2.3002 > 10.10.0.2.51410: S 1620691920:1620691920(0) ack 1595493702 win 5792 <mss 1452,sackOK,timestamp 204816 204705,nop,wscale 1>
09:26:50.557405 IP 10.10.0.2.51410 > 10.30.0.2.3002: . ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.557518 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 1:1441(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.557533 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 1441:2881(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.559399 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 1441 win 4344 <nop,nop,timestamp 204816 204711>
09:26:50.559418 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 2881 win 5792 <nop,nop,timestamp 204816 204711>
09:26:50.559904 IP 10.10.0.2.51410 > 10.30.0.2.3002: P 2881:4321(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.560709 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 4321 win 7240 <nop,nop,timestamp 204816 204711>
09:26:50.560919 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 4321:5761(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.560942 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 5761:7201(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.560954 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 7201:8641(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.560967 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 8641:10081(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.560981 IP 10.10.0.2.51410 > 10.30.0.2.3002: P 10081:11521(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.562162 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 5761 win 8688 <nop,nop,timestamp 204816 204711>
09:26:50.562182 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 7201 win 10136 <nop,nop,timestamp 204816 204711>
09:26:50.562193 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 8641 win 11584 <nop,nop,timestamp 204816 204711>
09:26:50.562205 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 10081 win 13032 <nop,nop,timestamp 204816 204711>
09:26:50.562216 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 11521 win 14480 <nop,nop,timestamp 204816 204711>
09:26:50.562691 IP 10.10.0.2.51410 > 10.30.0.2.3002: P 11521:12961(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.562782 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 12961:14401(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.563090 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 14401:15841(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.563114 IP 10.10.0.2.51410 > 10.30.0.2.3002: P 15841:16385(544) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.563612 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 12961 win 15928 <nop,nop,timestamp 204816 204711>
09:26:50.563677 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 14401 win 17376 <nop,nop,timestamp 204816 204711>
09:26:50.563717 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 15841 win 18824 <nop,nop,timestamp 204816 204711>
09:26:50.564152 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 16385 win 18824 <nop,nop,timestamp 204816 204711>
09:26:50.564191 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 16385:17825(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.564209 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 17825:19265(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.564221 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 19265:20705(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.564232 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 20705:22145(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.564243 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 22145:23585(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.564721 IP 10.10.0.2.51410 > 10.30.0.2.3002: P 23585:24577(992) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.564744 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 24577:26017(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.564756 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 26017:27457(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.565248 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 17825 win 20272 <nop,nop,timestamp 204816 204711>
09:26:50.565307 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 19265 win 21720 <nop,nop,timestamp 204816 204711>
09:26:50.565413 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 20705 win 23138 <nop,nop,timestamp 204816 204711>
09:26:50.565449 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 27457:28897(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.565756 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 28897:30337(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.566057 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 30337:31777(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.566612 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 31777:33217(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.566637 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 33217:34657(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.566978 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 34657:36097(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.567003 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 36097:37537(1440) ack 1 win 2920 <nop,nop,timestamp 204711 204816>
09:26:50.587879 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 37537 win 15434 <nop,nop,timestamp 204820 204711>
09:26:50.588202 IP 10.10.0.2.51410 > 10.30.0.2.3002: P 37537:38977(1440) ack 1 win 2920 <nop,nop,timestamp 204714 204820>
09:26:50.588217 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 38977:40417(1440) ack 1 win 2920 <nop,nop,timestamp 204714 204820>
09:26:50.588224 IP 10.10.0.2.51410 > 10.30.0.2.3002: P 40417:40961(544) ack 1 win 2920 <nop,nop,timestamp 204714 204820>
09:26:50.588231 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 40961:42401(1440) ack 1 win 2920 <nop,nop,timestamp 204714 204820>
09:26:50.588238 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 42401:43841(1440) ack 1 win 2920 <nop,nop,timestamp 204714 204820>
09:26:50.588245 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 43841:45281(1440) ack 1 win 2920 <nop,nop,timestamp 204714 204820>
09:26:50.588252 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 45281:46721(1440) ack 1 win 2920 <nop,nop,timestamp 204714 204820>
09:26:50.588259 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 46721:48161(1440) ack 1 win 2920 <nop,nop,timestamp 204714 204820>
09:26:50.588926 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 48161:49601(1440) ack 1 win 2920 <nop,nop,timestamp 204714 204820>
09:26:50.588940 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 49601:51041(1440) ack 1 win 2920 <nop,nop,timestamp 204714 204820>
09:26:50.588947 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 51041:52481(1440) ack 1 win 2920 <nop,nop,timestamp 204714 204820>
09:26:50.589278 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 52481:53921(1440) ack 1 win 2920 <nop,nop,timestamp 204714 204820>
09:26:50.589292 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 53921:55361(1440) ack 1 win 2920 <nop,nop,timestamp 204714 204820>
09:26:50.627856 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 55361 win 7088 <nop,nop,timestamp 204824 204714>
09:26:50.628228 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 55361:56801(1440) ack 1 win 2920 <nop,nop,timestamp 204718 204824>
09:26:50.628247 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 56801:58241(1440) ack 1 win 2920 <nop,nop,timestamp 204718 204824>
09:26:50.628254 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 58241:59681(1440) ack 1 win 2920 <nop,nop,timestamp 204718 204824>
09:26:50.628260 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 59681:61121(1440) ack 1 win 2920 <nop,nop,timestamp 204718 204824>
09:26:50.628266 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 61121:62561(1440) ack 1 win 2920 <nop,nop,timestamp 204718 204824>
09:26:50.628273 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 62561:64001(1440) ack 1 win 2920 <nop,nop,timestamp 204718 204824>
09:26:50.628279 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 64001:65441(1440) ack 1 win 2920 <nop,nop,timestamp 204718 204824>
09:26:50.628286 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 65441:66881(1440) ack 1 win 2920 <nop,nop,timestamp 204718 204824>
09:26:50.628292 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 66881:68321(1440) ack 1 win 2920 <nop,nop,timestamp 204718 204824>
09:26:50.667923 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 68321 win 1310 <nop,nop,timestamp 204828 204718>
09:26:50.668269 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 68321:69761(1440) ack 1 win 2920 <nop,nop,timestamp 204722 204828>
09:26:50.707868 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 69761 win 590 <nop,nop,timestamp 204832 204722>
09:26:50.925990 IP 10.10.0.2.51410 > 10.30.0.2.3002: P 69761:70941(1180) ack 1 win 2920 <nop,nop,timestamp 204748 204832>
09:26:50.926705 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 70941 win 0 <nop,nop,timestamp 204853 204748>
09:26:51.145881 IP 10.10.0.2.51410 > 10.30.0.2.3002: . ack 1 win 2920 <nop,nop,timestamp 204770 204853>
09:26:51.146948 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 70941 win 0 <nop,nop,timestamp 204875 204748>
09:26:51.585919 IP 10.10.0.2.51410 > 10.30.0.2.3002: . ack 1 win 2920 <nop,nop,timestamp 204814 204875>
09:26:51.586710 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 70941 win 0 <nop,nop,timestamp 204919 204748>
09:26:52.465905 IP 10.10.0.2.51410 > 10.30.0.2.3002: . ack 1 win 2920 <nop,nop,timestamp 204902 204919>
09:26:52.466821 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 70941 win 0 <nop,nop,timestamp 205007 204748>
09:26:52.568494 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 70941 win 1310 <nop,nop,timestamp 205018 204748>
09:26:52.569454 IP 10.30.0.2.3002 > 10.10.0.2.51410: . ack 70941 win 3236 <nop,nop,timestamp 205018 204748>
09:26:52.570062 IP 10.30.0.2.3002 > 10.10.0.2.51410: R 1:1(0) ack 70941 win 23168 <nop,nop,timestamp 205018 204748>
09:26:52.570874 IP 10.10.0.2.51410 > 10.30.0.2.3002: P 70941:71201(260) ack 1 win 2920 <nop,nop,timestamp 204912 205018>
09:26:52.571641 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 71201:72641(1440) ack 1 win 2920 <nop,nop,timestamp 204912 205018>
09:26:52.571696 IP 10.30.0.2.3002 > 10.10.0.2.51410: R 1620691921:1620691921(0) win 0
09:26:52.572207 IP 10.30.0.2.3002 > 10.10.0.2.51410: R 1620691921:1620691921(0) win 0
09:26:52.574496 IP 10.10.0.2.51410 > 10.30.0.2.3002: . 72641:74081(1440) ack 1 win 2920 <nop,nop,timestamp 204912 205018>
09:26:52.575160 IP 10.30.0.2.3002 > 10.10.0.2.51410: R 1620691921:1620691921(0) win 0
\end{Verbatim}

Запустим программу \textbf{win} на машине \textbf{c4}:
\begin{Verbatim}
./win 3002 2 10
\end{Verbatim}

Запустим клиент на той же машине:
\begin{Verbatim}
netcat localhost 3002 </dev/zero
\end{Verbatim}

Вывод \textbf{tcpdump} на машине \textbf{с4} (интерфейс \textbf{lo}):
\begin{Verbatim}
09:32:36.268708 IP 127.0.0.1.50974 > 127.0.0.1.3002: S 2744975071:2744975071(0) win 32792 <mss 16396,sackOK,timestamp 239406 0,nop,wscale 1>
09:32:36.268734 IP 127.0.0.1.3002 > 127.0.0.1.50974: S 2740376611:2740376611(0) ack 2744975072 win 32768 <mss 16396,sackOK,timestamp 239406 239406,nop,wscale 1>
09:32:36.268751 IP 127.0.0.1.50974 > 127.0.0.1.3002: . ack 1 win 16396 <nop,nop,timestamp 239406 239406>
09:32:36.269002 IP 127.0.0.1.50974 > 127.0.0.1.3002: P 1:8193(8192) ack 1 win 16396 <nop,nop,timestamp 239406 239406>
09:32:36.269014 IP 127.0.0.1.3002 > 127.0.0.1.50974: . ack 8193 win 24576 <nop,nop,timestamp 239406 239406>
09:32:36.269079 IP 127.0.0.1.50974 > 127.0.0.1.3002: P 8193:16385(8192) ack 1 win 16396 <nop,nop,timestamp 239406 239406>
09:32:36.269087 IP 127.0.0.1.3002 > 127.0.0.1.50974: . ack 16385 win 24576 <nop,nop,timestamp 239406 239406>
09:32:36.269150 IP 127.0.0.1.50974 > 127.0.0.1.3002: P 16385:24577(8192) ack 1 win 16396 <nop,nop,timestamp 239406 239406>
09:32:36.269157 IP 127.0.0.1.3002 > 127.0.0.1.50974: . ack 24577 win 23120 <nop,nop,timestamp 239406 239406>
09:32:36.269220 IP 127.0.0.1.50974 > 127.0.0.1.3002: P 24577:32769(8192) ack 1 win 16396 <nop,nop,timestamp 239406 239406>
09:32:36.269330 IP 127.0.0.1.50974 > 127.0.0.1.3002: P 32769:49153(16384) ack 1 win 16396 <nop,nop,timestamp 239406 239406>
09:32:36.269445 IP 127.0.0.1.50974 > 127.0.0.1.3002: P 49153:65537(16384) ack 1 win 16396 <nop,nop,timestamp 239406 239406>
09:32:36.286648 IP 127.0.0.1.3002 > 127.0.0.1.50974: . ack 65537 win 2640 <nop,nop,timestamp 239413 239406>
09:32:36.502686 IP 127.0.0.1.50974 > 127.0.0.1.3002: P 65537:70817(5280) ack 1 win 16396 <nop,nop,timestamp 239434 239413>
09:32:36.502707 IP 127.0.0.1.3002 > 127.0.0.1.50974: . ack 70817 win 0 <nop,nop,timestamp 239434 239434>
09:32:36.712680 IP 127.0.0.1.50974 > 127.0.0.1.3002: . ack 1 win 16396 <nop,nop,timestamp 239455 239434>
09:32:36.712709 IP 127.0.0.1.3002 > 127.0.0.1.50974: . ack 70817 win 0 <nop,nop,timestamp 239455 239434>
09:32:37.132724 IP 127.0.0.1.50974 > 127.0.0.1.3002: . ack 1 win 16396 <nop,nop,timestamp 239497 239455>
09:32:37.132764 IP 127.0.0.1.3002 > 127.0.0.1.50974: . ack 70817 win 0 <nop,nop,timestamp 239497 239434>
09:32:37.972722 IP 127.0.0.1.50974 > 127.0.0.1.3002: . ack 1 win 16396 <nop,nop,timestamp 239581 239497>
09:32:37.972761 IP 127.0.0.1.3002 > 127.0.0.1.50974: . ack 70817 win 0 <nop,nop,timestamp 239581 239434>
09:32:38.273436 IP 127.0.0.1.3002 > 127.0.0.1.50974: . ack 70817 win 8420 <nop,nop,timestamp 239611 239434>
09:32:38.273489 IP 127.0.0.1.50974 > 127.0.0.1.3002: P 70817:81921(11104) ack 1 win 16396 <nop,nop,timestamp 239611 239611>
09:32:38.273518 IP 127.0.0.1.3002 > 127.0.0.1.50974: . ack 81921 win 2868 <nop,nop,timestamp 239611 239611>
09:32:38.275412 IP 127.0.0.1.3002 > 127.0.0.1.50974: R 1:1(0) ack 81921 win 24576 <nop,nop,timestamp 239611 239611>
\end{Verbatim}

\section{Окно отправителя}

На машине \textbf{c5} установите задержку канала 100мс:
\begin{Verbatim}
/etc/delay 100
\end{Verbatim}

Будем слать пакеты с машины \textbf{c1} на discard-сервер на машине \textbf{c5}.

На машине \textbf{c1} выполним следующую команду:
\begin{Verbatim}
./nagle nodelay 10.40.0.2 9 1 20
\end{Verbatim}

Вывод \textbf{tcpdump} на машине \textbf{c2}:
\begin{Verbatim}
08:49:54.638463 IP 10.10.0.2.60585 > 10.40.0.2.9: S 2298095046:2298095046(0) win 5840 <mss 1460,sackOK,timestamp 4294944730 0,nop,wscale 1>
08:49:54.867429 IP 10.40.0.2.9 > 10.10.0.2.60585: S 2295061465:2295061465(0) ack 2298095047 win 5792 <mss 1460,sackOK,timestamp 4294944754 4294944730,nop,wscale 1>
08:49:54.867893 IP 10.10.0.2.60585 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 4294944755 4294944754>
08:49:54.868416 IP 10.10.0.2.60585 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 4294944755 4294944754>
08:49:54.876643 IP 10.10.0.2.60585 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 4294944757 4294944754>
08:49:54.977631 IP 10.40.0.2.9 > 10.10.0.2.60585: . ack 101 win 2896 <nop,nop,timestamp 4294944765 4294944755>
08:49:54.977678 IP 10.40.0.2.9 > 10.10.0.2.60585: . ack 201 win 2896 <nop,nop,timestamp 4294944765 4294944757>
08:49:54.978148 IP 10.10.0.2.60585 > 10.40.0.2.9: P 201:1201(1000) ack 1 win 2920 <nop,nop,timestamp 4294944766 4294944765>
08:49:54.986557 IP 10.10.0.2.60585 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 4294944768 4294944765>
08:49:54.992411 IP 10.10.0.2.60585 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 4294944768 4294944765>
08:49:55.002447 IP 10.10.0.2.60585 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 4294944769 4294944765>
08:49:55.063255 IP 10.10.0.2.60585 > 10.40.0.2.9: FP 1501:2001(500) ack 1 win 2920 <nop,nop,timestamp 4294944775 4294944765>
08:49:55.087597 IP 10.40.0.2.9 > 10.10.0.2.60585: . ack 1201 win 3896 <nop,nop,timestamp 4294944776 4294944766>
08:49:55.087641 IP 10.40.0.2.9 > 10.10.0.2.60585: . ack 1301 win 3896 <nop,nop,timestamp 4294944776 4294944768>
08:49:55.097616 IP 10.40.0.2.9 > 10.10.0.2.60585: . ack 1401 win 3896 <nop,nop,timestamp 4294944776 4294944768>
08:49:55.107598 IP 10.40.0.2.9 > 10.10.0.2.60585: . ack 1501 win 3896 <nop,nop,timestamp 4294944779 4294944769>
08:49:55.177595 IP 10.40.0.2.9 > 10.10.0.2.60585: F 1:1(0) ack 2002 win 4896 <nop,nop,timestamp 4294944784 4294944775>
08:49:55.177941 IP 10.10.0.2.60585 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 4294944786 4294944784>
\end{Verbatim}

На машине \textbf{c1} выполним следующую команду:
\begin{Verbatim}
./nagle nodelay 10.40.0.2 9 1 50
\end{Verbatim}

Вывод \textbf{tcpdump} на машине \textbf{c2}:
\begin{Verbatim}
08:50:55.450183 IP 10.10.0.2.60586 > 10.40.0.2.9: S 3241700605:3241700605(0) win 5840 <mss 1460,sackOK,timestamp 4294950810 0,nop,wscale 1>
08:50:55.557787 IP 10.40.0.2.9 > 10.10.0.2.60586: S 3245161837:3245161837(0) ack 3241700606 win 5792 <mss 1460,sackOK,timestamp 4294950823 4294950810,nop,wscale 1>
08:50:55.558772 IP 10.10.0.2.60586 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 4294950824 4294950823>
08:50:55.559025 IP 10.10.0.2.60586 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 4294950824 4294950823>
08:50:55.567382 IP 10.10.0.2.60586 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 4294950826 4294950823>
08:50:55.572409 IP 10.10.0.2.60586 > 10.40.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 4294950826 4294950823>
08:50:55.667650 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 101 win 2896 <nop,nop,timestamp 4294950834 4294950824>
08:50:55.668143 IP 10.10.0.2.60586 > 10.40.0.2.9: P 301:1201(900) ack 1 win 2920 <nop,nop,timestamp 4294950835 4294950834>
08:50:55.676321 IP 10.10.0.2.60586 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 4294950837 4294950834>
08:50:55.684969 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 201 win 2896 <nop,nop,timestamp 4294950834 4294950826>
08:50:55.685010 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 301 win 2896 <nop,nop,timestamp 4294950834 4294950826>
08:50:55.685304 IP 10.10.0.2.60586 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 4294950837 4294950834>
08:50:55.695459 IP 10.10.0.2.60586 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 4294950839 4294950834>
08:50:55.702534 IP 10.10.0.2.60586 > 10.40.0.2.9: P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 4294950839 4294950834>
08:50:55.713035 IP 10.10.0.2.60586 > 10.40.0.2.9: P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 4294950841 4294950834>
08:50:55.777574 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 1201 win 3796 <nop,nop,timestamp 4294950845 4294950835>
08:50:55.777617 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 1301 win 3796 <nop,nop,timestamp 4294950845 4294950837>
08:50:55.778689 IP 10.10.0.2.60586 > 10.40.0.2.9: P 1701:2301(600) ack 1 win 2920 <nop,nop,timestamp 4294950846 4294950845>
08:50:55.786695 IP 10.10.0.2.60586 > 10.40.0.2.9: P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 4294950848 4294950845>
08:50:55.792435 IP 10.10.0.2.60586 > 10.40.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 4294950848 4294950845>
08:50:55.801093 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 1401 win 3796 <nop,nop,timestamp 4294950847 4294950837>
08:50:55.801134 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 1501 win 3796 <nop,nop,timestamp 4294950847 4294950839>
08:50:55.807603 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 1601 win 3796 <nop,nop,timestamp 4294950848 4294950839>
08:50:55.815814 IP 10.10.0.2.60586 > 10.40.0.2.9: P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 4294950851 4294950848>
08:50:55.822398 IP 10.10.0.2.60586 > 10.40.0.2.9: P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 4294950851 4294950848>
08:50:55.830881 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 1701 win 3796 <nop,nop,timestamp 4294950850 4294950841>
08:50:55.839092 IP 10.10.0.2.60586 > 10.40.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 4294950853 4294950850>
08:50:55.842569 IP 10.10.0.2.60586 > 10.40.0.2.9: P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 4294950853 4294950850>
08:50:55.852290 IP 10.10.0.2.60586 > 10.40.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 4294950854 4294950850>
08:50:55.862034 IP 10.10.0.2.60586 > 10.40.0.2.9: P 3001:3101(100) ack 1 win 2920 <nop,nop,timestamp 4294950855 4294950850>
08:50:55.887573 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 2301 win 4696 <nop,nop,timestamp 4294950856 4294950846>
08:50:55.887616 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 2401 win 4696 <nop,nop,timestamp 4294950856 4294950848>
08:50:55.888207 IP 10.10.0.2.60586 > 10.40.0.2.9: P 3101:3201(100) ack 1 win 2920 <nop,nop,timestamp 4294950857 4294950856>
08:50:55.897179 IP 10.10.0.2.60586 > 10.40.0.2.9: P 3201:3301(100) ack 1 win 2920 <nop,nop,timestamp 4294950859 4294950856>
08:50:55.902519 IP 10.10.0.2.60586 > 10.40.0.2.9: P 3301:3401(100) ack 1 win 2920 <nop,nop,timestamp 4294950859 4294950856>
08:50:55.911182 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 2501 win 4696 <nop,nop,timestamp 4294950856 4294950848>
08:50:55.917601 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 2601 win 4696 <nop,nop,timestamp 4294950859 4294950851>
08:50:55.925903 IP 10.10.0.2.60586 > 10.40.0.2.9: P 3401:3501(100) ack 1 win 2920 <nop,nop,timestamp 4294950862 4294950859>
08:50:55.933030 IP 10.10.0.2.60586 > 10.40.0.2.9: P 3501:3601(100) ack 1 win 2920 <nop,nop,timestamp 4294950863 4294950859>
08:50:55.941558 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 2701 win 4696 <nop,nop,timestamp 4294950859 4294950851>
08:50:55.941598 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 2801 win 4696 <nop,nop,timestamp 4294950862 4294950853>
08:50:55.947529 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 2901 win 4696 <nop,nop,timestamp 4294950862 4294950853>
08:50:55.955204 IP 10.10.0.2.60586 > 10.40.0.2.9: P 3601:3701(100) ack 1 win 2920 <nop,nop,timestamp 4294950865 4294950862>
08:50:55.957770 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 3001 win 4696 <nop,nop,timestamp 4294950862 4294950854>
08:50:55.963510 IP 10.10.0.2.60586 > 10.40.0.2.9: P 3701:3801(100) ack 1 win 2920 <nop,nop,timestamp 4294950866 4294950862>
08:50:55.972046 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 3101 win 4696 <nop,nop,timestamp 4294950865 4294950855>
08:50:55.972627 IP 10.10.0.2.60586 > 10.40.0.2.9: P 3801:3901(100) ack 1 win 2920 <nop,nop,timestamp 4294950866 4294950865>
08:50:55.982532 IP 10.10.0.2.60586 > 10.40.0.2.9: P 3901:4001(100) ack 1 win 2920 <nop,nop,timestamp 4294950868 4294950865>
08:50:55.989910 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 3201 win 4696 <nop,nop,timestamp 4294950867 4294950857>
08:50:55.997804 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 3301 win 4696 <nop,nop,timestamp 4294950867 4294950859>
08:50:55.998385 IP 10.10.0.2.60586 > 10.40.0.2.9: P 4001:4101(100) ack 1 win 2920 <nop,nop,timestamp 4294950869 4294950867>
08:50:56.002499 IP 10.10.0.2.60586 > 10.40.0.2.9: P 4101:4201(100) ack 1 win 2920 <nop,nop,timestamp 4294950869 4294950867>
08:50:56.012097 IP 10.10.0.2.60586 > 10.40.0.2.9: P 4201:4301(100) ack 1 win 2920 <nop,nop,timestamp 4294950870 4294950867>
08:50:56.020671 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 3401 win 4696 <nop,nop,timestamp 4294950867 4294950859>
08:50:56.022891 IP 10.10.0.2.60586 > 10.40.0.2.9: P 4301:4401(100) ack 1 win 2920 <nop,nop,timestamp 4294950872 4294950867>
08:50:56.028815 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 3501 win 4696 <nop,nop,timestamp 4294950870 4294950862>
08:50:56.036617 IP 10.10.0.2.60586 > 10.40.0.2.9: P 4401:4501(100) ack 1 win 2920 <nop,nop,timestamp 4294950873 4294950870>
08:50:56.039442 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 3601 win 4696 <nop,nop,timestamp 4294950870 4294950863>
08:50:56.045819 IP 10.10.0.2.60586 > 10.40.0.2.9: P 4501:4601(100) ack 1 win 2920 <nop,nop,timestamp 4294950874 4294950870>
08:50:56.052511 IP 10.10.0.2.60586 > 10.40.0.2.9: P 4601:4701(100) ack 1 win 2920 <nop,nop,timestamp 4294950874 4294950870>
08:50:56.059236 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 3701 win 4696 <nop,nop,timestamp 4294950873 4294950865>
08:50:56.067601 IP 10.10.0.2.60586 > 10.40.0.2.9: P 4701:4801(100) ack 1 win 2920 <nop,nop,timestamp 4294950876 4294950873>
08:50:56.067664 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 3801 win 4696 <nop,nop,timestamp 4294950874 4294950866>
08:50:56.073177 IP 10.10.0.2.60586 > 10.40.0.2.9: P 4801:4901(100) ack 1 win 2920 <nop,nop,timestamp 4294950877 4294950874>
08:50:56.082353 IP 10.10.0.2.60586 > 10.40.0.2.9: P 4901:5001(100) ack 1 win 2920 <nop,nop,timestamp 4294950877 4294950874>
08:50:56.091062 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 3901 win 4696 <nop,nop,timestamp 4294950876 4294950866>
08:50:56.091648 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 4001 win 4696 <nop,nop,timestamp 4294950877 4294950868>
08:50:56.103591 IP 10.10.0.2.60586 > 10.40.0.2.9: F 5001:5001(0) ack 1 win 2920 <nop,nop,timestamp 4294950879 4294950877>
08:50:56.119139 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 4101 win 4696 <nop,nop,timestamp 4294950878 4294950869>
08:50:56.119696 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 4201 win 4696 <nop,nop,timestamp 4294950878 4294950869>
08:50:56.120171 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 4301 win 4696 <nop,nop,timestamp 4294950878 4294950870>
08:50:56.129236 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 4401 win 4696 <nop,nop,timestamp 4294950881 4294950872>
08:50:56.137662 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 4501 win 4696 <nop,nop,timestamp 4294950882 4294950873>
08:50:56.147795 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 4601 win 4696 <nop,nop,timestamp 4294950883 4294950874>
08:50:56.157620 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 4701 win 4696 <nop,nop,timestamp 4294950883 4294950874>
08:50:56.177620 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 4801 win 4696 <nop,nop,timestamp 4294950885 4294950876>
08:50:56.177667 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 4901 win 4696 <nop,nop,timestamp 4294950885 4294950877>
08:50:56.187782 IP 10.40.0.2.9 > 10.10.0.2.60586: . ack 5001 win 4696 <nop,nop,timestamp 4294950885 4294950877>
08:50:56.217738 IP 10.40.0.2.9 > 10.10.0.2.60586: F 1:1(0) ack 5002 win 4696 <nop,nop,timestamp 4294950889 4294950879>
08:50:56.218089 IP 10.10.0.2.60586 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 4294950890 4294950889>
\end{Verbatim}

\section{Нейгл+Мишналь}

Выпоним на клиенте \textbf{c1}:
\begin{Verbatim}
./nagle default 10.40.0.2 9 0 30
\end{Verbatim}

Вывод tcpdump на клиенте \textbf{c2}:

\begin{Verbatim}
07:07:52.801501 IP 10.10.0.2.59332 > 10.40.0.2.9: S 1189569171:1189569171(0) win 5840 <mss 1460,sackOK,timestamp 63465 0,nop,wscale 1>
07:07:53.230583 IP 10.40.0.2.9 > 10.10.0.2.59332: S 1185602995:1185602995(0) ack 1189569172 win 5792 <mss 1460,sackOK,timestamp 63487 63465,nop,wscale 1>
07:07:53.231066 IP 10.10.0.2.59332 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 63513 63487>
07:07:53.231802 IP 10.10.0.2.59332 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 63513 63487>
07:07:53.237157 IP 10.10.0.2.59332 > 10.40.0.2.9: . 101:1549(1448) ack 1 win 2920 <nop,nop,timestamp 63515 63487>
07:07:53.440561 IP 10.40.0.2.9 > 10.10.0.2.59332: . ack 101 win 2896 <nop,nop,timestamp 63508 63513>
07:07:53.440606 IP 10.40.0.2.9 > 10.10.0.2.59332: . ack 1549 win 4344 <nop,nop,timestamp 63508 63515>
07:07:53.572295 IP 10.10.0.2.59332 > 10.40.0.2.9: . 1549:2997(1448) ack 1 win 2920 <nop,nop,timestamp 63548 63508>
07:07:53.573277 IP 10.10.0.2.59332 > 10.40.0.2.9: FP 2997:3001(4) ack 1 win 2920 <nop,nop,timestamp 63548 63508>
07:07:53.780713 IP 10.40.0.2.9 > 10.10.0.2.59332: . ack 2997 win 5792 <nop,nop,timestamp 63542 63548>
07:07:53.780756 IP 10.40.0.2.9 > 10.10.0.2.59332: F 1:1(0) ack 3002 win 5792 <nop,nop,timestamp 63542 63548>
07:07:53.781670 IP 10.10.0.2.59332 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 63568 63542>
\end{Verbatim}

Видно, что, если сторона уже получила подтверждение приёма всех отправленных
данных, то новые данные отправляются сразу, а иначе они накапливаются, пока их
размер не достигнет MSS (в случае размера окна, превышающего величину MSS).

\section{Отправка без задержки}

На машине c5 установите задержку канала 100мс.
\begin{Verbatim}
/etc/delay 100
\end{Verbatim}

На машине c1 выполним
\begin{Verbatim}
./nagle nodelay 10.40.0.2 9 1 20
\end{Verbatim}

Вывод tcpdump на клиенте с2:
\begin{Verbatim}
07:18:53.459816 IP 10.10.0.2.39174 > 10.40.0.2.9: S 2944769757:2944769757(0) win 5840 <mss 1460,sackOK,timestamp 129534 0,nop,wscale 1>
07:18:53.570404 IP 10.40.0.2.9 > 10.10.0.2.39174: S 2951948929:2951948929(0) ack 2944769758 win 5792 <mss 1460,sackOK,timestamp 129530 129534,nop,wscale 1>
07:18:53.570714 IP 10.10.0.2.39174 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 129547 129530>
07:18:53.570770 IP 10.10.0.2.39174 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 129547 129530>
07:18:53.578996 IP 10.10.0.2.39174 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 129549 129530>
07:18:53.680410 IP 10.40.0.2.9 > 10.10.0.2.39174: . ack 101 win 2896 <nop,nop,timestamp 129542 129547>
07:18:53.680427 IP 10.40.0.2.9 > 10.10.0.2.39174: . ack 201 win 2896 <nop,nop,timestamp 129542 129549>
07:18:53.680768 IP 10.10.0.2.39174 > 10.40.0.2.9: P 201:1201(1000) ack 1 win 2920 <nop,nop,timestamp 129558 129542>
07:18:53.688834 IP 10.10.0.2.39174 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 129560 129542>
07:18:53.694807 IP 10.10.0.2.39174 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 129560 129542>
07:18:53.704907 IP 10.10.0.2.39174 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 129561 129542>
07:18:53.765720 IP 10.10.0.2.39174 > 10.40.0.2.9: FP 1501:2001(500) ack 1 win 2920 <nop,nop,timestamp 129567 129542>
07:18:53.790602 IP 10.40.0.2.9 > 10.10.0.2.39174: . ack 1201 win 3896 <nop,nop,timestamp 129553 129558>
07:18:53.790648 IP 10.40.0.2.9 > 10.10.0.2.39174: . ack 1301 win 3896 <nop,nop,timestamp 129553 129560>
07:18:53.800700 IP 10.40.0.2.9 > 10.10.0.2.39174: . ack 1401 win 3896 <nop,nop,timestamp 129553 129560>
07:18:53.810593 IP 10.40.0.2.9 > 10.10.0.2.39174: . ack 1501 win 3896 <nop,nop,timestamp 129556 129561>
07:18:53.880520 IP 10.40.0.2.9 > 10.10.0.2.39174: F 1:1(0) ack 2002 win 4896 <nop,nop,timestamp 129561 129567>
07:18:53.880819 IP 10.10.0.2.39174 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 129578 129561>
\end{Verbatim}

Видно, что после получения подтверждения на 2-ой отправленный пакет, мы отправляем
следующий пакет, размер которого 1000 байт. Это нам и говорит обуферизации.

\section{Быстрый повтор}

На машине \textbf{c3} выполним следующие команды
\begin{Verbatim}
/etc/drop 11
tcpdump -n -i eth0 tcp
\end{Verbatim}

На машине c1 запустим tcpdump (при помощи screen), а затем клиента, например nagle.
\begin{Verbatim}
./nagle nodelay 10.30.0.2 9 1 30
\end{Verbatim}

tcpdump на c1
\begin{Verbatim}
07:31:40.391774 IP 10.10.0.2.60199 > 10.30.0.2.9: S 2089600113:2089600113(0) win 5840
 <mss 1460,sackOK,timestamp 206289 0,nop,wscale 1>
07:31:43.363341 IP 10.10.0.2.60199 > 10.30.0.2.9: S 2089600113:2089600113(0) win 5840
 <mss 1460,sackOK,timestamp 206589 0,nop,wscale 1>
07:31:43.375815 IP 10.30.0.2.9 > 10.10.0.2.60199: S 2138368551:2138368551(0) ack 2089
600114 win 5792 <mss 1452,sackOK,timestamp 206573 206589,nop,wscale 1>
07:31:43.375937 IP 10.10.0.2.60199 > 10.30.0.2.9: . ack 1 win 2920 <nop,nop,timestamp
 206591 206573>
07:31:43.377492 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1:101(100) ack 1 win 2920 <nop,no
p,timestamp 206591 206573>
07:31:43.380591 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 101 win 2896 <nop,nop,timesta
mp 206573 206591>
07:31:43.390514 IP 10.10.0.2.60199 > 10.30.0.2.9: P 101:201(100) ack 1 win 2920 <nop,
nop,timestamp 206592 206573>
07:31:43.392161 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 201 win 2896 <nop,nop,timesta
mp 206573 206592>
07:31:43.395418 IP 10.10.0.2.60199 > 10.30.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 206593 206573>
07:31:43.397322 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 301 win 2896 <nop,nop,timestamp 206573 206593>
07:31:43.405691 IP 10.10.0.2.60199 > 10.30.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 206594 206573>
07:31:43.414553 IP 10.10.0.2.60199 > 10.30.0.2.9: P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 206595 206573>
07:31:43.415900 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 501 win 2896 <nop,nop,timestamp 206573 206595>
07:31:43.425209 IP 10.10.0.2.60199 > 10.30.0.2.9: P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 206596 206573>
07:31:43.426998 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 601 win 2896 <nop,nop,timestamp 206580 206596>
07:31:43.436066 IP 10.10.0.2.60199 > 10.30.0.2.9: P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 206597 206580>
07:31:43.437640 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 701 win 2896 <nop,nop,timestamp 206580 206597>
07:31:43.443424 IP 10.10.0.2.60199 > 10.30.0.2.9: P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 206597 206580>
07:31:43.446712 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 801 win 2896 <nop,nop,timestamp 206580 206597>
07:31:43.457187 IP 10.10.0.2.60199 > 10.30.0.2.9: P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 206599 206580>
07:31:43.458029 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 901 win 2896 <nop,nop,timestamp 206582 206599>
07:31:43.465037 IP 10.10.0.2.60199 > 10.30.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 206600 206582>
07:31:43.473715 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 206601 206582>
07:31:43.474634 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 901 win 2896 <nop,nop,timestamp 206584 206599,nop,nop,sack 1 {1001:1101}>
07:31:43.484951 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 206602 206584>
07:31:43.487203 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 901 win 2896 <nop,nop,timestamp 206586 206599,nop,nop,sack 1 {1001:1201}>
07:31:43.496365 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 206603 206586>
07:31:43.498213 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 901 win 2896 <nop,nop,timestamp 206586 206599,nop,nop,sack 1 {1001:1301}>
07:31:43.498267 IP 10.10.0.2.60199 > 10.30.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 206603 206586>
07:31:43.499983 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1301 win 2896 <nop,nop,timestamp 206586 206603>
07:31:43.505658 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 206604 206586>
07:31:43.507116 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1401 win 2896 <nop,nop,timestamp 206586 206604>
07:31:43.515492 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 206605 206586>
07:31:43.523910 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 206606 206586>
07:31:43.525003 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1401 win 2896 <nop,nop,timestamp 206588 206604,nop,nop,sack 1 {1501:1601}>
07:31:43.534987 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 206607 206588>
07:31:43.536394 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1401 win 2896 <nop,nop,timestamp 206590 206604,nop,nop,sack 1 {1501:1701}>
07:31:43.545405 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 206608 206590>
07:31:43.550053 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1401 win 2896 <nop,nop,timestamp 206592 206604,nop,nop,sack 1 {1501:1801}>
07:31:43.550127 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 206608 206592>
07:31:43.551833 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1801 win 2896 <nop,nop,timestamp 206592 206608>
07:31:43.558436 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 206609 206592>
07:31:43.566650 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1901 win 2896 <nop,nop,timestamp 206593 206609>
07:31:43.566718 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 206610 206593>
07:31:43.577542 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2001:2101(100) ack 1 win 2920 <nop,nop,timestamp 206611 206593>
07:31:43.579286 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1901 win 2896 <nop,nop,timestamp 206594 206609,nop,nop,sack 1 {2001:2101}>
07:31:43.585929 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2101:2201(100) ack 1 win 2920 <nop,nop,timestamp 206612 206594>
07:31:43.587278 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1901 win 2896 <nop,nop,timestamp 206594 206609,nop,nop,sack 1 {2001:2201}>
07:31:43.595486 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 206613 206594>
07:31:43.596947 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1901 win 2896 <nop,nop,timestamp 206596 206609,nop,nop,sack 1 {2001:2301}>
07:31:43.597073 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 206613 206596>
07:31:43.598416 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2301 win 2896 <nop,nop,timestamp 206596 206613>
07:31:43.607658 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 206614 206596>
07:31:43.609951 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2401 win 2896 <nop,nop,timestamp 206598 206614>
07:31:43.614494 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 206615 206598>
07:31:43.624204 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 206616 206598>
07:31:43.625311 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2401 win 2896 <nop,nop,timestamp 206598 206614,nop,nop,sack 1 {2501:2601}>
07:31:43.634996 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 206617 206598>
07:31:43.636128 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2401 win 2896 <nop,nop,timestamp 206600 206614,nop,nop,sack 1 {2501:2701}>
07:31:43.645141 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 206618 206600>
07:31:43.648279 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2401 win 2896 <nop,nop,timestamp 206601 206614,nop,nop,sack 1 {2501:2801}>
07:31:43.648361 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 206618 206601>
07:31:43.649343 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2801 win 2896 <nop,nop,timestamp 206601 206618>
07:31:43.595486 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 206613 206594>
07:31:43.596947 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1901 win 2896 <nop,nop,timestamp 206596 206609,nop,nop,sack 1 {2001:2301}>
07:31:43.597073 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 206613 206596>
07:31:43.598416 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2301 win 2896 <nop,nop,timestamp 206596 206613>
07:31:43.607658 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 206614 206596>
07:31:43.609951 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2401 win 2896 <nop,nop,timestamp 206598 206614>
07:31:43.614494 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 206615 206598>
07:31:43.624204 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 206616 206598>
07:31:43.625311 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2401 win 2896 <nop,nop,timestamp 206598 206614,nop,nop,sack 1 {2501:2601}>
07:31:43.634996 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 206617 206598>
07:31:43.636128 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2401 win 2896 <nop,nop,timestamp 206600 206614,nop,nop,sack 1 {2501:2701}>
07:31:43.645141 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 206618 206600>
07:31:43.648279 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2401 win 2896 <nop,nop,timestamp 206601 206614,nop,nop,sack 1 {2501:2801}>
07:31:43.648361 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 206618 206601>
07:31:43.649343 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2801 win 2896 <nop,nop,timestamp 206601 206618>
07:31:43.657187 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 206619 206601>
\end{Verbatim}

tcpdump на c3
\begin{Verbatim}
07:31:40.721738 IP 10.10.0.2.60199 > 10.30.0.2.9: S 2089600113:2089600113(0) win 5840 <mss 1460,sackOK,timestamp 206289 0,nop,wscale 1>
07:31:43.682842 IP 10.10.0.2.60199 > 10.30.0.2.9: S 2089600113:2089600113(0) win 5840 <mss 1460,sackOK,timestamp 206589 0,nop,wscale 1>
07:31:43.693937 IP 10.30.0.2.9 > 10.10.0.2.60199: S 2138368551:2138368551(0) ack 2089600114 win 5792 <mss 1452,sackOK,timestamp 206573 206589,nop,wscale 1>
07:31:43.695580 IP 10.10.0.2.60199 > 10.30.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 206591 206573>
07:31:43.698206 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 206591 206573>
07:31:43.698773 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 101 win 2896 <nop,nop,timestamp 206573 206591>
07:31:43.710448 IP 10.10.0.2.60199 > 10.30.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 206592 206573>
07:31:43.711123 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 201 win 2896 <nop,nop,timestamp 206573 206592>
07:31:43.715342 IP 10.10.0.2.60199 > 10.30.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 206593 206573>
07:31:43.716129 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 301 win 2896 <nop,nop,timestamp 206573 206593>
07:31:43.725295 IP 10.10.0.2.60199 > 10.30.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 206594 206573>
07:31:43.734298 IP 10.10.0.2.60199 > 10.30.0.2.9: P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 206595 206573>
07:31:43.734669 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 501 win 2896 <nop,nop,timestamp 206573 206595>
07:31:43.744997 IP 10.10.0.2.60199 > 10.30.0.2.9: P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 206596 206573>
07:31:43.745657 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 601 win 2896 <nop,nop,timestamp 206580 206596>
07:31:43.755659 IP 10.10.0.2.60199 > 10.30.0.2.9: P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 206597 206580>
07:31:43.756428 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 701 win 2896 <nop,nop,timestamp 206580 206597>
07:31:43.763138 IP 10.10.0.2.60199 > 10.30.0.2.9: P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 206597 206580>
07:31:43.764899 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 801 win 2896 <nop,nop,timestamp 206580 206597>
07:31:43.776689 IP 10.10.0.2.60199 > 10.30.0.2.9: P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 206599 206580>
07:31:43.776991 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 901 win 2896 <nop,nop,timestamp 206582 206599>
07:31:43.784646 IP 10.10.0.2.60199 > 10.30.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 206600 206582>
07:31:43.793177 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 206601 206582>
07:31:43.793374 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 901 win 2896 <nop,nop,timestamp 206584 206599,nop,nop,sack 1 {1001:1101}>
07:31:43.804901 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 206602 206584>
07:31:43.805568 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 901 win 2896 <nop,nop,timestamp 206586 206599,nop,nop,sack 1 {1001:1201}>
07:31:43.815952 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 206603 206586>
07:31:43.816660 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 901 win 2896 <nop,nop,timestamp 206586 206599,nop,nop,sack 1 {1001:1301}>
07:31:43.817928 IP 10.10.0.2.60199 > 10.30.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 206603 206586>
07:31:43.818611 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1301 win 2896 <nop,nop,timestamp 206586 206603>
07:31:43.825274 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 206604 206586>
07:31:43.825762 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1401 win 2896 <nop,nop,timestamp 206586 206604>
07:31:43.835278 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 206605 206586>
07:31:43.843531 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 206606 206586>
07:31:43.843906 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1401 win 2896 <nop,nop,timestamp 206588 206604,nop,nop,sack 1 {1501:1601}>
07:31:43.854700 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 206607 206588>
07:31:43.855287 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1401 win 2896 <nop,nop,timestamp 206590 206604,nop,nop,sack 1 {1501:1701}>
07:31:43.865884 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 206608 206590>
07:31:43.868842 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1401 win 2896 <nop,nop,timestamp 206592 206604,nop,nop,sack 1 {1501:1801}>
07:31:43.870231 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 206608 206592>
07:31:43.870771 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1801 win 2896 <nop,nop,timestamp 206592 206608>
07:31:43.878117 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 206609 206592>
07:31:43.882237 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1901 win 2896 <nop,nop,timestamp 206593 206609>
07:31:43.886214 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 206610 206593>
07:31:43.897185 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2001:2101(100) ack 1 win 2920 <nop,nop,timestamp 206611 206593>
07:31:43.897947 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1901 win 2896 <nop,nop,timestamp 206594 206609,nop,nop,sack 1 {2001:2101}>
07:31:43.905533 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2101:2201(100) ack 1 win 2920 <nop,nop,timestamp 206612 206594>
07:31:43.906042 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1901 win 2896 <nop,nop,timestamp 206594 206609,nop,nop,sack 1 {2001:2201}>
07:31:43.915129 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 206613 206594>
07:31:43.915554 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 1901 win 2896 <nop,nop,timestamp 206596 206609,nop,nop,sack 1 {2001:2301}>
07:31:43.916749 IP 10.10.0.2.60199 > 10.30.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 206613 206596>
07:31:43.917185 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2301 win 2896 <nop,nop,timestamp 206596 206613>
07:31:43.927426 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 206614 206596>
07:31:43.928062 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2401 win 2896 <nop,nop,timestamp 206598 206614>
07:31:43.934112 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 206615 206598>
07:31:43.943771 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 206616 206598>
07:31:43.944214 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2401 win 2896 <nop,nop,timestamp 206598 206614,nop,nop,sack 1 {2501:2601}>
07:31:43.954643 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 206617 206598>
07:31:43.955034 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2401 win 2896 <nop,nop,timestamp 206600 206614,nop,nop,sack 1 {2501:2701}>
07:31:43.964860 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 206618 206600>
07:31:43.966199 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2401 win 2896 <nop,nop,timestamp 206601 206614,nop,nop,sack 1 {2501:2801}>
07:31:43.967954 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 206618 206601>
07:31:43.968317 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2801 win 2896 <nop,nop,timestamp 206601 206618>
07:31:43.977069 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 206619 206601>
07:31:43.978132 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2901 win 2896 <nop,nop,timestamp 206601 206619>
07:31:43.983974 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 206620 206601>
07:31:43.994765 IP 10.10.0.2.60199 > 10.30.0.2.9: F 3001:3001(0) ack 1 win 2920 <nop,nop,timestamp 206621 206601>
07:31:43.995144 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 2901 win 2896 <nop,nop,timestamp 206604 206619,nop,nop,sack 1 {3001:3002}>
07:31:44.202989 IP 10.10.0.2.60199 > 10.30.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 206641 206604>
07:31:44.203571 IP 10.30.0.2.9 > 10.10.0.2.60199: . ack 3002 win 2896 <nop,nop,timestamp 206624 206641>
07:31:44.210068 IP 10.30.0.2.9 > 10.10.0.2.60199: F 1:1(0) ack 3002 win 2896 <nop,nop,timestamp 206624 206641>
07:31:44.211227 IP 10.10.0.2.60199 > 10.30.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 206641 206624>
\end{Verbatim}

Как видно пакет 901 повторно отправляется на c3 после получение 4 ack на 901.

\section{Обычный повтор}

В ядре Linux невозможно отключить быстрый повтор, поэтому для демонстрации 
«медленного повтора» можно включить уже в ходе передачи данных большую задержку
на промежуточном узле, c3 следующим образом.
\begin{Verbatim}
/etc/delay 300
\end{Verbatim}

tcpdump на с1
\begin{Verbatim}
08:08:40.609318 IP 10.10.0.2.55769 > 10.30.0.2.9: S 2344712764:2344712764(0) wi
n 5840 <mss 1460,sackOK,timestamp 40675 0,nop,wscale 1>
08:08:43.588572 IP 10.10.0.2.55769 > 10.30.0.2.9: S 2344712764:2344712764(0) wi
n 5840 <mss 1460,sackOK,timestamp 40975 0,nop,wscale 1>
08:08:44.220653 IP 10.30.0.2.9 > 10.10.0.2.55769: S 2380802706:2380802706(0) ac
k 2344712765 win 5792 <mss 1452,sackOK,timestamp 40914 40975,nop,wscale 1>
08:08:44.220754 IP 10.10.0.2.55769 > 10.30.0.2.9: . ack 1 win 2920 <nop,nop,tim
estamp 41038 40914>
08:08:44.222736 IP 10.10.0.2.55769 > 10.30.0.2.9: P 1:101(100) ack 1 win 2920 <
nop,nop,timestamp 41038 40914>
08:08:44.234583 IP 10.10.0.2.55769 > 10.30.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 41040 40914>
08:08:44.239563 IP 10.10.0.2.55769 > 10.30.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 41041 40914>
08:08:44.540601 IP 10.30.0.2.9 > 10.10.0.2.55769: . ack 201 win 2896 <nop,nop,timestamp 40976 41040>
08:08:44.540722 IP 10.10.0.2.55769 > 10.30.0.2.9: . 301:1741(1440) ack 1 win 2920 <nop,nop,timestamp 41070 40976>
08:08:44.540805 IP 10.10.0.2.55769 > 10.30.0.2.9: FP 1741:3001(1260) ack 1 win 2920 <nop,nop,timestamp 41070 40976>
08:08:44.552241 IP 10.30.0.2.9 > 10.10.0.2.55769: . ack 301 win 2896 <nop,nop,timestamp 40976 41041>
08:08:44.850652 IP 10.30.0.2.9 > 10.10.0.2.55769: . ack 301 win 2896 <nop,nop,timestamp 41008 41041,nop,nop,sack 1 {1741:3002}>
08:08:47.148535 IP 10.10.0.2.55769 > 10.30.0.2.9: . 301:1741(1440) ack 1 win 2920 <nop,nop,timestamp 41331 41008>
08:08:47.450811 IP 10.30.0.2.9 > 10.10.0.2.55769: . ack 3002 win 4344 <nop,nop,timestamp 41269 41331>
08:08:50.290557 IP 10.30.0.2.9 > 10.10.0.2.55769: F 1:1(0) ack 3002 win 4344 <nop,nop,timestamp 41553 41331>
08:08:50.290701 IP 10.10.0.2.55769 > 10.30.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 41645 41553>
\end{Verbatim}

Видно, что повторная передача происходит по таймауту в 3 секунды.

\section{Неудачная попытка соединени с портом}

Будем устанавливать соединение клиента \textbf{c1} с клиентом \textbf{с5} на порту 1025,
который никто не слушает.
\begin{Verbatim}
telnet 10.40.0.2 1025
Trying 10.40.0.2...
telnet: Unable to connect to remote host: Connection refused
\end{Verbatim}

Вывод tcpdump на клиенте \textbf{с2}:
\begin{Verbatim}
06:59:36.796445 IP 10.10.0.2.44844 > 10.40.0.2.1025: S 1983361825:1983361825(0) win 5840 <mss 1460,sackOK,timestamp 13861 0,nop,wscale 1>
06:59:37.230682 IP 10.40.0.2.1025 > 10.10.0.2.44844: R 0:0(0) ack 1983361826 win 0
\end{Verbatim}

\section{Опыт с PMTU}

Для опыта нужно на \textbf{c3} и \textbf{c4} отключить \textbf{tcpclump}. Для этого
выполним:
\begin{Verbatim}
iptables -F
\end{Verbatim}

Теперь будем соединяться с discard-сервером на машине \textbf{c6} с клиента на машине
\textbf{с1}:
\begin{Verbatim}
./nagle cork 10.50.0.2 9 1 50
\end{Verbatim}

Вывод tcpdump на клиенте \textbf{с2} на интерфейсе \textbf{eth0}:
\begin{Verbatim}
08:19:32.341064 IP 10.10.0.2.39365 > 10.50.0.2.9: S 3898647808:3898647808(0) win 5840 <mss 1460,sackOK,timestamp 4294952073 0,nop,wscale 1>
08:19:32.378013 IP 10.50.0.2.9 > 10.10.0.2.39365: S 3897763950:3897763950(0) ack 3898647809 win 5792 <mss 1460,sackOK,timestamp 4294952083 4294952073,nop,wscale 1>
08:19:32.378589 IP 10.10.0.2.39365 > 10.50.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 4294952081 4294952083>
08:19:32.512890 IP 10.10.0.2.39365 > 10.50.0.2.9: . 1:1449(1448) ack 1 win 2920 <nop,nop,timestamp 4294952095 4294952083>
08:19:32.513789 IP 10.10.0.2.39365 > 10.50.0.2.9: . 1:1441(1440) ack 1 win 2920 <nop,nop,timestamp 4294952095 4294952083>
08:19:32.513875 IP 10.10.0.2.39365 > 10.50.0.2.9: . 1441:1449(8) ack 1 win 2920 <nop,nop,timestamp 4294952095 4294952083>
08:19:32.515583 IP 10.50.0.2.9 > 10.10.0.2.39365: . ack 1 win 2896 <nop,nop,timestamp 4294952097 4294952081,nop,nop,sack 1 {1441:1449}>
08:19:32.515910 IP 10.10.0.2.39365 > 10.50.0.2.9: . 1:525(524) ack 1 win 2920 <nop,nop,timestamp 4294952095 4294952097>
08:19:32.516074 IP 10.10.0.2.39365 > 10.50.0.2.9: . 525:1049(524) ack 1 win 2920 <nop,nop,timestamp 4294952095 4294952097>
08:19:32.517422 IP 10.50.0.2.9 > 10.10.0.2.39365: . ack 525 win 3432 <nop,nop,timestamp 4294952097 4294952095,nop,nop,sack 1 {1441:1449}>
08:19:32.517494 IP 10.50.0.2.9 > 10.10.0.2.39365: . ack 1049 win 3956 <nop,nop,timestamp 4294952097 4294952095,nop,nop,sack 1 {1441:1449}>
08:19:32.517900 IP 10.10.0.2.39365 > 10.50.0.2.9: . 1049:1441(392) ack 1 win 2920 <nop,nop,timestamp 4294952095 4294952097>
08:19:32.519285 IP 10.50.0.2.9 > 10.10.0.2.39365: . ack 1449 win 4480 <nop,nop,timestamp 4294952097 4294952095>
08:19:32.562789 IP 10.10.0.2.39365 > 10.50.0.2.9: . 1449:1973(524) ack 1 win 2920 <nop,nop,timestamp 4294952100 4294952097>
08:19:32.564133 IP 10.50.0.2.9 > 10.10.0.2.39365: . ack 1973 win 5004 <nop,nop,timestamp 4294952102 4294952100>
08:19:32.612803 IP 10.10.0.2.39365 > 10.50.0.2.9: . 1973:2497(524) ack 1 win 2920 <nop,nop,timestamp 4294952105 4294952102>
08:19:32.614046 IP 10.50.0.2.9 > 10.10.0.2.39365: . ack 2497 win 5528 <nop,nop,timestamp 4294952107 4294952105>
08:19:32.672925 IP 10.10.0.2.39365 > 10.50.0.2.9: . 2497:3021(524) ack 1 win 2920 <nop,nop,timestamp 4294952111 4294952107>
08:19:32.674273 IP 10.50.0.2.9 > 10.10.0.2.39365: . ack 3021 win 6052 <nop,nop,timestamp 4294952113 4294952111>
08:19:32.722991 IP 10.10.0.2.39365 > 10.50.0.2.9: . 3021:3545(524) ack 1 win 2920 <nop,nop,timestamp 4294952116 4294952113>
08:19:32.724565 IP 10.50.0.2.9 > 10.10.0.2.39365: . ack 3545 win 6576 <nop,nop,timestamp 4294952118 4294952116>
08:19:32.772798 IP 10.10.0.2.39365 > 10.50.0.2.9: . 3545:4069(524) ack 1 win 2920 <nop,nop,timestamp 4294952121 4294952118>
08:19:32.774057 IP 10.50.0.2.9 > 10.10.0.2.39365: . ack 4069 win 7100 <nop,nop,timestamp 4294952123 4294952121>
08:19:32.822763 IP 10.10.0.2.39365 > 10.50.0.2.9: . 4069:4593(524) ack 1 win 2920 <nop,nop,timestamp 4294952126 4294952123>
08:19:32.824109 IP 10.50.0.2.9 > 10.10.0.2.39365: . ack 4593 win 7624 <nop,nop,timestamp 4294952128 4294952126>
08:19:32.873673 IP 10.10.0.2.39365 > 10.50.0.2.9: FP 4593:5001(408) ack 1 win 2920 <nop,nop,timestamp 4294952131 4294952128>
08:19:32.879219 IP 10.50.0.2.9 > 10.10.0.2.39365: F 1:1(0) ack 5002 win 8148 <nop,nop,timestamp 4294952133 4294952131>
08:19:32.879655 IP 10.10.0.2.39365 > 10.50.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 4294952131 4294952133>
\end{Verbatim}

Видно, что получено извещение о невозможности отправки пакетов без фрагментации:
\begin{Verbatim}
08:19:32.512890 IP 10.10.0.2.39365 > 10.50.0.2.9: . 1:1449(1448) ack 1 win 2920 <nop,nop,timestamp 4294952095 4294952083>
08:19:32.513789 IP 10.10.0.2.39365 > 10.50.0.2.9: . 1:1441(1440) ack 1 win 2920 <nop,nop,timestamp 4294952095 4294952083>
08:19:32.513875 IP 10.10.0.2.39365 > 10.50.0.2.9: . 1441:1449(8) ack 1 win 2920 <nop,nop,timestamp 4294952095 4294952083>
08:19:32.515583 IP 10.50.0.2.9 > 10.10.0.2.39365: . ack 1 win 2896 <nop,nop,timestamp 4294952097 4294952081,nop,nop,sack 1 {1441:1449}>
\end{Verbatim}

\end{document}
