\documentclass[a4paper,12pt]{article}

\input{header.tex}

\title{Отчёт по лабораторной работе \\ <<Локальные сети>>}
\author{Фроловский Алексей Вадимлвич}

\begin{document}

\maketitle

\tableofcontents

% Текст отчёта должен быть читаемым!!! Написанное здесь является рыбой.

\section{Получение адреса по DHCP}

Получение "случайного" адреса можно продемонстрировать на примере
сети \textbf{lan2} с адресом \textbf{10.102.0.0/16}. Для этого
необходимо настроить службу DHCP на маршрутизаторе \textbf{r2}:
в файле \textbf{/etc/dhcp3/dhcpd.conf} следует указать следующие
настройки:
\begin{Verbatim}
subnet 172.16.0.0 netmask 255.255.0.0 \{\}

subnet 10.102.0.0 netmask 255.255.0.0
\{
  range 10.102.0.2 10.102.0.200;
  option routers 10.102.0.1;
  option domain-name-servers 192.168.0.1;
\}
\end{Verbatim}

Отметим, что в настройке \textbf{range} указывается диапазон,
в котором будут динамически выдаваться ip-адреса, в
\textbf{option routers} - ip-адреса маршрутизаторов сети,
\textbf{option domain-name-servers} - ip-адреса DNS-серверов.

Выполним на маршрутизаторе \textbf{r2}:
\begin{Verbatim}
tcpdump -tnv -i eth0 udp
\end{Verbatim}

Получим следующий вывод:
\begin{Verbatim}
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:ee, 
		length 300, xid 0x82701421, Flags [none]
          Client-Ethernet-Address 10:10:10:10:10:ee [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.102.0.1.67 > 10.102.0.2.68: BOOTP/DHCP, Reply, length 300, xid 0x82701421, Flags [none]
          Your-IP 10.102.0.2
          Client-Ethernet-Address 10:10:10:10:10:ee [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:ee, 
		length 300, xid 0x82701421, Flags [none]
          Client-Ethernet-Address 10:10:10:10:10:ee [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.102.0.1.67 > 10.102.0.2.68: BOOTP/DHCP, Reply, length 300, xid 0x82701421, Flags [none]
          Your-IP 10.102.0.2
          Client-Ethernet-Address 10:10:10:10:10:ee [|bootp]
IP (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto UDP (17), length 328) 
	10.102.0.2.68 > 10.102.0.1.67: BOOTP/DHCP, Request from 10:10:10:10:10:ee, 
		length 300, xid 0x7185b80d, Flags [none]
          Client-IP 10.102.0.2
          Client-Ethernet-Address 10:10:10:10:10:ee [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:ee, 
		length 300, xid 0xe433c82b, Flags [none]
          Client-Ethernet-Address 10:10:10:10:10:ee [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.102.0.1.67 > 10.102.0.2.68: BOOTP/DHCP, Reply, length 300, xid 0xe433c82b, Flags [none]
          Your-IP 10.102.0.2
          Client-Ethernet-Address 10:10:10:10:10:ee [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:ee, 
		length 300, xid 0xe433c82b, Flags [none]
          Client-Ethernet-Address 10:10:10:10:10:ee [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.102.0.1.67 > 10.102.0.2.68: BOOTP/DHCP, Reply, length 300, xid 0xe433c82b, Flags [none]
          Your-IP 10.102.0.2
          Client-Ethernet-Address 10:10:10:10:10:ee [|bootp]
\end{Verbatim}

Получение "фиксированных" адресов можно продемонстрировать на
примере сети \textbf{lan1} с адресом \textbf{10.0.0.0/16}. Для
этого необходимо настроить службу DHCP на маршрутизаторе
\textbf{r1}: в файле \textbf{/etc/dhcp3/dhcpd.conf} следует
указать следующие настройки:
\begin{Verbatim}
subnet 172.16.0.0 netmask 255.255.0.0 \{\}

subnet 10.0.0.0 netmask 255.255.0.0
\{
  range 10.0.0.2 10.0.10.200;
  option routers 10.0.0.1;
  option domain-name-servers 192.168.0.1;
\}

host ws11 \{
    hardware ethernet 10:10:10:10:10:BA;
    fixed-address 10.0.1.1;
\}

host ws12 \{
    hardware ethernet 10:10:10:10:10:BB;
    fixed-address 10.0.2.1;
\}

host ws13 \{
    hardware ethernet 10:10:10:10:10:BC;
    fixed-address 10.0.3.1;
\}

host s11 \{
    hardware ethernet 10:10:10:10:20:AA;
    fixed-address 10.0.4.10;
\}

host s12 \{
    hardware ethernet 10:10:10:10:20:BB;
    fixed-address 10.0.4.20;
\}
\end{Verbatim}

Выполним на маршрутизаторе \textbf{r2}:
\begin{Verbatim}
tcpdump -tnv -i eth0 udp
\end{Verbatim}

Получим следующий вывод:
\begin{Verbatim}
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:20:bb, 
		length 300, xid 0x28576d02, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:20:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.4.20.68: BOOTP/DHCP, Reply, 
		length 300, xid 0x28576d02, Flags [none]
	  Your-IP 10.0.4.20
	  Client-Ethernet-Address 10:10:10:10:20:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:20:bb, 
		length 300, xid 0x28576d02, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:20:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.4.20.68: BOOTP/DHCP, Reply, length 300, xid 0x28576d02, Flags [none]
	  Your-IP 10.0.4.20
	  Client-Ethernet-Address 10:10:10:10:20:bb [|bootp]
IP (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto UDP (17), length 328) 
	10.0.4.10.68 > 10.0.0.1.67: BOOTP/DHCP, Request from 10:10:10:10:20:aa, 
		length 300, xid 0xc48d122e, Flags [none]
	  Client-IP 10.0.4.10
	  Client-Ethernet-Address 10:10:10:10:20:aa [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:ba, 
		length 300, xid 0xad5a342d, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:10:ba [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.1.1.68: BOOTP/DHCP, Reply, length 300, xid 0xad5a342d, Flags [none]
	  Your-IP 10.0.1.1
	  Client-Ethernet-Address 10:10:10:10:10:ba [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:ba, 
		length 300, xid 0xad5a342d, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:10:ba [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.1.1.68: BOOTP/DHCP, Reply, length 300, xid 0xad5a342d, Flags [none]
	  Your-IP 10.0.1.1
	  Client-Ethernet-Address 10:10:10:10:10:ba [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:bb, 
		length 300, xid 0xa001b35a, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:10:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.2.1.68: BOOTP/DHCP, Reply, length 300, xid 0xa001b35a, Flags [none]
	  Your-IP 10.0.2.1
	  Client-Ethernet-Address 10:10:10:10:10:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:bb, 
		length 300, xid 0xa001b35a, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:10:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.2.1.68: BOOTP/DHCP, Reply, length 300, xid 0xa001b35a, Flags [none]
	  Your-IP 10.0.2.1
	  Client-Ethernet-Address 10:10:10:10:10:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:20:bb, 
		length 300, xid 0x93a8a447, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:20:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.4.20.68: BOOTP/DHCP, Reply, length 300, xid 0x93a8a447, Flags [none]
	  Your-IP 10.0.4.20
	  Client-Ethernet-Address 10:10:10:10:20:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:20:bb, 
		length 300, xid 0x93a8a447, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:20:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.4.20.68: BOOTP/DHCP, Reply, length 300, xid 0x93a8a447, Flags [none]
	  Your-IP 10.0.4.20
	  Client-Ethernet-Address 10:10:10:10:20:bb [|bootp]
IP (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto UDP (17), length 328) 
	10.0.1.1.68 > 10.0.0.1.67: BOOTP/DHCP, Request from 10:10:10:10:10:ba, 
		length 300, xid 0x437a631f, Flags [none]
	  Client-IP 10.0.1.1
	  Client-Ethernet-Address 10:10:10:10:10:ba [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:bc, 
		length 300, xid 0xecf5c126, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:10:bc [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.3.1.68: BOOTP/DHCP, Reply, length 300, xid 0xecf5c126, Flags [none]
	  Your-IP 10.0.3.1
	  Client-Ethernet-Address 10:10:10:10:10:bc [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:bc, 
		length 300, xid 0xecf5c126, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:10:bc [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.3.1.68: BOOTP/DHCP, Reply, length 300, xid 0xecf5c126, Flags [none]
	  Your-IP 10.0.3.1
	  Client-Ethernet-Address 10:10:10:10:10:bc [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:ba, 
		length 300, xid 0x58752e33, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:10:ba [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.1.1.68: BOOTP/DHCP, Reply, length 300, xid 0x58752e33, Flags [none]
	  Your-IP 10.0.1.1
	  Client-Ethernet-Address 10:10:10:10:10:ba [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:ba, 
		length 300, xid 0x58752e33, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:10:ba [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.1.1.68: BOOTP/DHCP, Reply, length 300, xid 0x58752e33, Flags [none]
	  Your-IP 10.0.1.1
	  Client-Ethernet-Address 10:10:10:10:10:ba [|bootp]
IP (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto UDP (17), length 328) 
	10.0.2.1.68 > 10.0.0.1.67: BOOTP/DHCP, Request from 10:10:10:10:10:bb, 
		length 300, xid 0x193e306b, Flags [none]
	  Client-IP 10.0.2.1
	  Client-Ethernet-Address 10:10:10:10:10:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:bb, 
		length 300, xid 0x8511b67e, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:10:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.2.1.68: BOOTP/DHCP, Reply, length 300, xid 0x8511b67e, Flags [none]
	  Your-IP 10.0.2.1
	  Client-Ethernet-Address 10:10:10:10:10:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:bb, 
		length 300, xid 0x8511b67e, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:10:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.2.1.68: BOOTP/DHCP, Reply, length 300, xid 0x8511b67e, Flags [none]
	  Your-IP 10.0.2.1
	  Client-Ethernet-Address 10:10:10:10:10:bb [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:20:aa, 
		length 300, xid 0xd215445, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:20:aa [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.4.10.68: BOOTP/DHCP, Reply, length 300, xid 0xd215445, Flags [none]
	  Your-IP 10.0.4.10
	  Client-Ethernet-Address 10:10:10:10:20:aa [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:20:aa, 
		length 300, xid 0xd215445, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:20:aa [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.4.10.68: BOOTP/DHCP, Reply, length 300, xid 0xd215445, Flags [none]
	  Your-IP 10.0.4.10
	  Client-Ethernet-Address 10:10:10:10:20:aa [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:bc, 
		length 300, xid 0x3dad9929, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:10:bc [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.3.1.68: BOOTP/DHCP, Reply, length 300, xid 0x3dad9929, Flags [none]
	  Your-IP 10.0.3.1
	  Client-Ethernet-Address 10:10:10:10:10:bc [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:10:bc, 
		length 300, xid 0x3dad9929, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:10:bc [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.3.1.68: BOOTP/DHCP, Reply, length 300, xid 0x3dad9929, Flags [none]
	  Your-IP 10.0.3.1
	  Client-Ethernet-Address 10:10:10:10:10:bc [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:20:aa, 
		length 300, xid 0xd3cd0b29, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:20:aa [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.4.10.68: BOOTP/DHCP, Reply, length 300, xid 0xd3cd0b29, Flags [none]
	  Your-IP 10.0.4.10
	  Client-Ethernet-Address 10:10:10:10:20:aa [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 10:10:10:10:20:aa, 
		length 300, xid 0xd3cd0b29, Flags [none]
	  Client-Ethernet-Address 10:10:10:10:20:aa [|bootp]
IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328) 
	10.0.0.1.67 > 10.0.4.10.68: BOOTP/DHCP, Reply, length 300, xid 0xd3cd0b29, Flags [none]
	  Your-IP 10.0.4.10
	  Client-Ethernet-Address 10:10:10:10:20:aa [|bootp]
\end{Verbatim}


\section{Использование VPN}

Для создания виртуальной частной сети используется служба OpenVPN.
В качестве сервера выступает маршрутизатор \textbf{r1}, ожидающего подключение, а в качестве клиента - \textbf{r2}. Сервер управляет
настройками VPN, поэтому на маршрутизаторе \textbf{r1} следует
изменить файл \textbf{/etc/openvpn/tun0.conf} следующим образом:
\begin{Verbatim}
local 172.16.1.3
proto udp
port 1194
dev tun

ifconfig 10.200.1.1 10.200.1.2
secret /etc/openvpn/keys/somesecret.key
status /var/log/openvpn/tun0.status
log /var/log/openvpn/tun0.log
\end{Verbatim}

А на маршрутизаторе \textbf{r2} этот файл следует отредактировать
следующим образом:
\begin{Verbatim}
remote 172.16.1.3 1194 
proto udp
dev tun

ifconfig 10.200.1.2 10.200.1.1
secret /etc/openvpn/keys/somesecret.key
status /var/log/openvpn/tun0.status
log /var/log/openvpn/tun0.log
\end{Verbatim}

Выполним \textbf{ip r} на маршрутизаторе \textbf{r1}:
\begin{Verbatim}
10.200.1.2 dev tun0  proto kernel  scope link  src 10.200.1.1 
10.0.0.0/16 dev eth0  proto kernel  scope link  src 10.0.0.1 
10.102.0.0/16 via 10.200.1.2 dev tun0  proto zebra  metric 2 
172.16.0.0/16 dev eth1  proto kernel  scope link  src 172.16.1.3 
default via 172.16.1.2 dev eth1 
\end{Verbatim}

Выполним \textbf{ip r} на маршрутизаторе \textbf{r2}:
\begin{Verbatim}
10.200.1.1 dev tun0  proto kernel  scope link  src 10.200.1.2 
10.0.0.0/16 via 10.200.1.1 dev tun0  proto zebra  metric 2 
10.102.0.0/16 dev eth0  proto kernel  scope link  src 10.102.0.1 
172.16.0.0/16 dev eth1  proto kernel  scope link  src 172.16.1.4 
default via 172.16.1.2 dev eth1
\end{Verbatim}

Выполним \textbf{ip -4 a} на маршрутизаторе \textbf{r1}:
\begin{Verbatim}
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue 
    inet 127.0.0.1/8 scope host lo
3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 1000
    inet 172.16.1.3/16 brd 172.16.255.255 scope global eth1
4: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 1000
    inet 10.0.0.1/16 brd 10.0.255.255 scope global eth0
5: tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 100
    inet 10.200.1.1 peer 10.200.1.2/32 scope global tun0
\end{Verbatim}

Выполним \textbf{ip -4 a} на маршрутизаторе \textbf{r2}:
\begin{Verbatim}
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue 
    inet 127.0.0.1/8 scope host lo
3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 1000
    inet 172.16.1.4/16 brd 172.16.255.255 scope global eth1
4: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 1000
    inet 10.102.0.1/16 brd 10.102.255.255 scope global eth0
5: tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 100
    inet 10.200.1.2 peer 10.200.1.1/32 scope global tun0
\end{Verbatim}

Выполним \textbf{tcpdump -tvn -i tun0 -s 1518 udp} на маршрутизаторе
\textbf{r1}:
\begin{Verbatim}
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.2.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:      10.102.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.1.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:        10.0.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.2.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:      10.102.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.1.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:        10.0.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.2.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:      10.102.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.1.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:        10.0.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.2.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:      10.102.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.1.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:        10.0.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.2.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:      10.102.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.1.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:        10.0.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.2.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:      10.102.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.1.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:        10.0.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.2.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:      10.102.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.1.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:        10.0.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.2.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:      10.102.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.1.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:        10.0.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.2.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:      10.102.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.1.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:        10.0.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.2.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:      10.102.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.1.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:        10.0.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.2.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:      10.102.0.0/16, tag 0x0000, metric: 1, next-hop: self
IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 52) 10.200.1.1.520 > 224.0.0.9.520: 
	RIPv2, Response, length: 24, routes: 1
	  AFI: IPv4:        10.0.0.0/16, tag 0x0000, metric: 1, next-hop: self
\end{Verbatim}


\section{Правила фильтации пакетов и трансляции пдресов}

Где что дампим.

\begin{Verbatim}
сценарий фильтрации
\end{Verbatim}

\begin{Verbatim}
iptables -L -nv
\end{Verbatim}

\begin{Verbatim}
iptables -L -nv -t nat
\end{Verbatim}

\section{Проверка трансляции}

SNAT

\begin{Verbatim}
дамп SNAT в LAN
\end{Verbatim}

\begin{Verbatim}
дамп SNAT (снаружи)
\end{Verbatim}

DNAT

\begin{Verbatim}
дамп DNAT (снаружи)
\end{Verbatim}

\begin{Verbatim}
дамп DNAT в LAN
\end{Verbatim}


\section{Проверка правил фильтрации}

Используем telnet.

\section{Проверка доступа к внутреннему серверу}

Используем telnet.

\end{document}
